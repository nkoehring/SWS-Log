var textile;(function(){function r(a,b,c){var e=new RegExp("(?:^|\\{|\\[|(["+q+"]|\\s))"+a+"(?:"+f.source+" ?)?([^\\s"+a+"]+|\\S[^"+a+"\\n]*[^\\s"+a+"\\n])"+a+"(?:$|[\\]}]|("+d.source+"{1,2}|\\s))","g");return function(a){var d=[],f;while(f=e.exec(a)){var g=f[1]||"",h=f[4]||"",i=o(f[2]),j=this.makeTag(b,i),k=[a.slice(0,f.index)+g,h];if(c){var l=this.escapeHTML(f[3]);k.splice(1,0,j.open+l+j.close)}else k.splice(1,0,j.open,f[3],j.close);d=this.joinPhraseBits(d,k,d.length),a=a.slice(e.lastIndex),e.lastIndex=0}d.length&&(d[d.length-1]+=a);return d}}function o(a){var b={style:""};if(!a)return b;var c=0,d=0,e;if(e=m.exec(a)){var f=e[1];f.length&&!/;$/.test(f)&&(f+=";"),b.style=f}if(e=a.match(h))c+=e.length;if(e=a.match(i))d+=e.length;if(e=a.match(k)){var o=e.length;for(j=0;j<o&&e[j].length==2;j++);if(j<o){e=l.exec(e[j]);if(e[1]||e[2])c-=o-j,d-=o-j;e[1]&&(b["class"]=e[1]),e[2]&&(b.id=e[2])}}if(e=n.exec(a))b.lang=e[1];c>0&&(b.style+="padding-left:"+c+"em;"),d>0&&(b.style+="padding-right:"+d+"em;");if(e=g.exec(a))b.style+="text-align:"+g.values[e[0]]+";";return b}function a(a){this.osrc=this.src=a,this.out="",this.footnotes=[]}textile=function(b){tc=new a(b);return tc.convert()},a.prototype={convert:function(){this.src=this.src.replace(/^\n+/,"");while(this.src.length){for(var a=0;a<z.length;a++)if(z[a].match.apply(this)){z[a].do.apply(this);break}if(a==z.length)throw new Error("Error - couldn't match any block type for:\n\n"+this.src);this.out+="\n\n",this.src=this.src.replace(/^\n+/,"")}return this.out.trim()},getBlock:function(){var a=this.src.search("\n\n");a==-1&&(a=this.src.length);var b=this.src.slice(0,a).trim();this.src=this.src.slice(a+2);return b},getLine:function(){var a=this.src.search("\n");a==-1&&(a=this.src.length);var b=this.src.slice(0,a).trim();this.src=this.src.slice(a+1);return b},footnoteID:function(a){this.footnotes[a]||(this.footnotes[a]="fn"+(Math.random()+"").slice(2)+(new Date).getTime());return this.footnotes[a]},convertSpan:function(a){var b=[a];for(var c=0;c<p.length;c++)for(var d=0;d<b.length;d+=2){var e=p[c].call(this,b[d]);e.length&&(b[d]="",b=this.joinPhraseBits(b,e,d+1))}for(var c=0;c<b.length;c+=2)b[c]=this.convertGlyphs(b[c]);return b.join("")},joinPhraseBits:function(a,b,c){if(!a.length)return b;c=Math.min(c,a.length),c%2&&(a[c-1]+=b[0],b=b.slice(1)),b.length%2&&c<a.length&&b.length>1&&(a[c]+=b[b.length-1],b=b.slice(0,-1));return a.slice(0,c).concat(b,a.slice(c))},convertGlyphs:function(a){for(var b=0;b<e.length;b++)a=a.replace(e[b][0],e[b][1]);return a},makeTag:function(a,b){var c="<"+a;for(var d in b)b[d]&&(c+=" "+d+'="'+b[d]+'"');var e=c+" />";c+=">";var f="</"+a+">";return{single:e,open:c,close:f,name:a}}};var b=a.prototype.makeTag("p"),c=/<.*?>/g,d=/[!"#$%&\'()*+,\-./:;<=>?@[\\\]^_`{|}~]/,e=[[/\n(?! )/g,"<br />\n"],[/(\w)'(\w)/g,"$1&#8217;$2"],[/(\s)'(\d+\w?)\b(?!')/g,"$1&#8217;$2"],[new RegExp("(\\S)'(?=\\s|"+d.source+"|<|$)","g"),"$1&#8217;"],[/'/g,"&#8216;"],[new RegExp('(\\S)"(?=\\s|'+d.source+"|<|$)","g"),"$1&#8221;"],[/"/g,"&#8220;"],[/\b([A-Z][A-Z0-9]{2,})\b(?:\(([^\)]*)\))/g,'<acronym title="$2"><span class="caps">$1</span></acronym>'],[/\b([A-Z][A-Z'\-]+[A-Z])(?=[\s.,\)>]|$)/g,'<span class="caps">$1</span>'],[/\b( ?)\.{3}/g,"$1&#8230;"],[/(\s?)--(\s?)/g,"$1&#8212;$2"],[/(\s?)-(?:\s|$)/g," &#8211; "],[/(\d)( ?)x( ?)(?=\d)/g,"$1$2&#215;$3"],[/(?:^|\b)( ?)\(TM\)/gi,"$1&#8482;"],[/(?:^|\b)( ?)\(R\)/gi,"$1&#174;"],[/(?:^|\b)( ?)\(C\)/gi,"$1&#169;"]],f=/((?:<|>|=|<>|\(+(?!\w)|\)+|(?:\([^#\)]*(?:#(?:[a-zA-Z]+[_a-zA-Z0-9-:.]*))?\))|\{.*?\}|\[.*?\])+)/,g=/<>|<|>|=/;g.values={"<":"left",">":"right","<>":"justify","=":"center"};var h=/\(/g,i=/\)/g,k=/\(([^\(#\)]*)(?:#([a-zA-Z]+[_a-zA-Z0-9-:.]*))?\)/g,l=new RegExp(k.source),m=/\{(.*?)\}/,n=/\[(.*?)\]/,p=textile.phraseTypes=[],q="\\.,\"'?!;:";p.push(r("\\*\\*","b")),p.push(r("__","i")),p.push(r("\\*","strong")),p.push(r("_","em")),p.push(r("\\?\\?","cite")),p.push(r("\\-","del")),p.push(r("\\+","ins")),p.push(r("\\%","span")),p.push(r("~","sub")),p.push(r("\\^","sup"));var s=/(?:^|([\s(>])|\[|\{)@(.*?)@(?:([\s)])|$|\]|\})?/gm;p.push(function(a){var b=[],c;while(c=s.exec(a)){var d=c[1]||"",e=c[3]||"",f=[a.slice(0,c.index)+d,"<code>"+this.escapeHTML(c[2])+"</code>",e];b=this.joinPhraseBits(b,f,b.length),a=a.slice(s.lastIndex),s.lastIndex=0}b.length&&(b[b.length-1]+=a);return b});var t=/(?:^|([\s(>])|\[|\{)==(.*?)==(?:([\s)])|$|\]\})?/gm;p.push(function(a){var b=[],c;while(c=t.exec(a)){var d=c[1]||"",e=c[3]||"",f=[a.slice(0,c.index)+d,c[2],e];b=this.joinPhraseBits(b,f,b.length),a=a.slice(t.lastIndex),t.lastIndex=0}b.length&&(b[b.length-1]+=a);return b});var u=/(?:^|([\s(>])|\[|\{)"(.*?)(?:\((.*)\))?":(\S+?)(?:$|([\s),!?;]|\.(?:$|\s))|\]|\})/g;p.push(function(a){var b=[],c;while(c=u.exec(a)){var d=c[1]||"",e=c[5]||"",f={href:c[4],title:c[3]},g=this.makeTag("a",f),h=[a.slice(0,c.index)+d,g.open,c[2],g.close,e];b=this.joinPhraseBits(b,h,b.length),a=a.slice(u.lastIndex),u.lastIndex=0}b.length&&(b[b.length-1]+=a);return b});var v=/(?:^|([\s(>])|\[|\{)!(.*?)(?:\((.*)\))?!(?::(\S+))?(?:$|([\s)])|\]|\})/g;p.push(function(a){var b=[],c;while(c=v.exec(a)){var d=c[1]||"",e=c[5]||"",f={src:c[2],title:c[3],alt:c[3]},g=this.makeTag("img",f).single;if(c[4]){var h=this.makeTag("a",{href:c[4]});g=h.open+g+h.close}var i=[a.slice(0,c.index)+d,g,e];b=this.joinPhraseBits(b,i,b.length),a=a.slice(v.lastIndex),v.lastIndex=0}b.length&&(b[b.length-1]+=a);return b});var w=/(^|\S)\[(\d+)\]([\s\.,;:?!'"]|$)/g;p.push(function(a){var b=[],c;while(c=w.exec(a)){var d=c[1]||"",e=c[3]||"",f=this.footnoteID(c[2]),g=this.makeTag("a",{href:"#"+f}),h=[a.slice(0,c.index)+d,'<sup class="footnote">'+g.open+c[2]+g.close+"</sup>",e];b=this.joinPhraseBits(b,h,b.length),a=a.slice(w.lastIndex),w.lastIndex=0}b.length&&(b[b.length-1]+=a);return b});var x=/<code>((?:.|\n)*?)<\/code>/gm;p.push(function(a){var b,c=[];while(b=x.exec(a)){var d=a.slice(0,b.index),e="<code>"+this.escapeHTML(b[1])+"</code>";a=a.slice(x.lastIndex),d=this.convertGlyphs(d),c=this.joinPhraseBits(c,[d,e],c.length+1),x.lastIndex=0}c.length&&c.push(a);return c});var y=/<notextile>((?:.|\n)*?)<\/notextile>/gm;p.push(function(a){var b,c=[];while(b=y.exec(a)){var d=a.slice(0,b.index),e=b[1];a=a.slice(y.lastIndex),d=this.convertGlyphs(d),c=this.joinPhraseBits(c,[d,e],c.length+1),y.lastIndex=0}c.length&&c.push(a);return c}),p.push(function(a){var b,d=[];while(b=c.exec(a)){var e=a.slice(0,b.index),f=a.slice(b.index,c.lastIndex);a=a.slice(c.lastIndex),e=this.convertGlyphs(e),d=this.joinPhraseBits(d,[e,f],d.length+1),c.lastIndex=0}d.length&&d.push(a);return d});var z=textile.blockTypes=[],A=new RegExp("^[a-zA-Z][a-zA-Z0-9]*"+f.source+"?\\.+ "),B=new RegExp("^(#+|\\*+)"+f.source+"? "),C=a.prototype.makeTag("li"),D={match:function(){return B.test(this.src)},"do":function(){var a,b="",c=[],d=0,e,b="";while(a=this.src.match(B)){var a=this.src.match(B),b=a[1],f=b[0]=="#"?"ol":"ul",g=b.length;while(g<d){this.out+=C.close+"\n"+e.close;var h=c.pop()||{level:0};d=h.level,e=h.tag}if(g==d&&e&&f!=e.name){this.out+=e.close+C.close+"\n";var h=c.pop()||{level:0};d=h.level,e=h.tag}d>0&&(g==d&&(this.out+=C.close),this.out+="\n");if(g>d||a[2]){e&&c.push({level:d,tag:e});var i=o(a[2]);e=this.makeTag(f,i),d=g,this.out+=e.open+"\n"}this.src=this.src.slice(a[0].length);var j=this.getLine();j=this.convertSpan(j),this.out+=C.open+j}this.out+=C.close+"\n";while(c.length)this.out+=e.close+C.close+"\n",e=c.pop().tag;this.out+=e.close}};z.push(D);var E=new RegExp("^(table"+f.source+"?. *\\n)?(("+f.source+"?\\. )?\\|.*\\|\\n?)+(?:\\n\\n|$)"),F=new RegExp("^(?:"+f.source+"?\\. )?\\|.*\\|(?:\\n|$)"),G=new RegExp("^(_)?(\\^|-|~)?(?:\\\\(\\d+))?(?:/(\\d+))?"+f.source+"?\\. "),H={match:function(){return E.test(this.src)},"do":function(){var a=E.exec(this.src);if(a[1]){var b=o(a[2]);tableTag=this.makeTag("table",b),this.getLine()}else tableTag=this.makeTag("table");this.out+=tableTag.open+"\n";while(a=F.exec(this.src)){var c;a[1]?(b=o(a[1]),c=this.makeTag("tr",b)):c=this.makeTag("tr"),this.out+=c.open+"\n";var d=this.getLine(),e=d.split("|"),f=e.length;for(var g=1;g<f-1;g++){var h=e[g];if(a=G.exec(h)){h=h.slice(a[0].length),b=o(a[5]);var i=a[1]?"th":"td";switch(a[2]){case"^":b.style+="vertical-align:top;";break;case"-":b.style+="vertical-align:middle;";break;case"~":b.style+="vertical-align:bottom;"}a[3]&&(b.colspan=a[3]),a[4]&&(b.rowspan=a[4]);var j=this.makeTag(i,b)}else j=this.makeTag("td");h=this.convertSpan(h),this.out+=j.open+h+j.close+"\n"}this.out+=c.close+"\n"}this.out+=tableTag.close}};z.push(H);var I=new RegExp("^fn(\\d+)"+f.source+"?\\.(\\.)? "),J={match:function(){return I.test(this.src)},"do":function(){var a=this.src.match(I),b=parseInt(a[1]),c=o(a[2]);c.id=this.footnoteID(b),c["class"]="footnote";var d=this.makeTag("p",c),e=a[3]!=undefined;this.src=this.src.slice(a[0].length);var f=this.getBlock();f=this.convertSpan(f),this.out+=d.open+"<sup>"+b+"</sup> "+f+d.close;if(e)while(this.src.length&&!A.test(this.src)){var f=this.getBlock();f=this.convertSpan(f),this.out+="\n"+d.open+f+d.close}}};z.push(J);var K=new RegExp("^bq"+f.source+"?\\.(\\.)?(?::(\\S+))? "),L={match:function(){return K.test(this.src)},"do":function(){var a=this.src.match(K),b=o(a[1]),c=this.makeTag("p",b);a[3]&&(b.cite=a[3]);var d=this.makeTag("blockquote",b),e=a[2]!=undefined;this.src=this.src.slice(a[0].length);var f=this.getBlock();f=this.convertSpan(f),this.out+=d.open+"\n"+c.open+f+c.close;if(e)while(this.src.length&&!A.test(this.src)){var f=this.getBlock();f=this.convertSpan(f),this.out+="\n"+c.open+f+c.close}this.out+="\n"+d.close}};z.push(L);var M=new RegExp("^bc"+f.source+"?\\.(\\.)? "),N={match:function(){return M.test(this.src)},"do":function(){var a=this.src.match(M),b=o(a[1]),c=this.makeTag("code",b);a[3]&&(b.cite=a[3]);var d=this.makeTag("pre",b),e=a[2]!=undefined;this.src=this.src.slice(a[0].length);var f=this.getBlock();f=this.escapeHTML(f),this.out+=d.open+c.open+f+"\n"+c.close;if(e)while(this.src.length&&!A.test(this.src)){var f=this.getBlock();f=this.escapeHTML(f),this.out+="\n"+c.open+f+"\n"+c.close}this.out+=d.close}};z.push(N);var O=new RegExp("^pre"+f.source+"?.(.)? "),P={match:function(){return O.test(this.src)},"do":function(){var a=O.exec(this.src);this.src=this.src.slice(a[0].length);var b=o(a[1]),c=this.makeTag("pre",b),d=a[2]!=undefined,e=this.getBlock();if(d)while(this.src.length&&!A.test(this.src))e+="\n\n"+this.getBlock();e=this.escapeHTML(e),this.out+=c.open+e+"\n"+c.close}};z.push(P);var Q=new RegExp("^notextile"+f.source+"?.(.)? "),R={match:function(){return Q.test(this.src)},"do":function(){var a=this.src.match(Q),b=a[2]!=undefined;this.src=this.src.slice(a[0].length);var c=this.getBlock();this.out+=c;if(b)while(this.src.length&&!A.test(this.src)){var c=this.getBlock();this.out+="\n\n"+c}}};z.push(R);var S=["h1","h2","h3","h4","h5","h6","p","div"],T=new RegExp("^("+S.join("|")+")"+f.source+"?.(.)? "),U={match:function(){return T.test(this.src)},"do":function(){var a=this.src.match(T),b=a[1],c=o(a[2]),d=this.makeTag(b,c),e=a[3]!=undefined;this.src=this.src.slice(a[0].length);var f=this.getBlock();f=this.convertSpan(f),this.out+=d.open+f+d.close;if(e)while(this.src.length&&!A.test(this.src)){var f=this.getBlock();f=this.convertSpan(f),this.out+="\n"+d.open+f+d.close}}};z.push(U);var V=/^<pre((?:\s+\w+(?:\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)>((?:.|\n(?!\n))*)<\/pre>(?:\n\n|$)/,W={match:function(){return V.test(this.src)},"do":function(){var a=V.exec(this.src);this.src=this.src.slice(a[0].length);var b=a[1],c=this.escapeHTML(a[2]);this.out+="<pre"+b+">"+c+"</pre>"}};z.push(W);var X=/^<(\w+)((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)>(.|\n(?!\n))*<\/\1>(\n\n|$)/,Y="a abbr acronym b bdo big br cite code dfn em i img input kbd label q samp select small span strong sub sup textarea tt var notextile",Z={match:function(){var a=this.src.match(X);if(a)return Y.search(a[1])==-1},"do":function(){var a=X.exec(this.src)[0];this.src=this.src.slice(a.length),this.out+=a}};z.push(Z);var $={match:function(){return this.src.match(/^ /)},"do":function(){var a=this.getBlock();a=this.convertSpan(a),this.out+=a}};z.push($);var _={match:function(){return!0},"do":function(){var a=this.getBlock();a=this.convertSpan(a),this.out+=b.open+a+b.close}};z.push(_);var ba=["&","&#38;","<","&#60;",">","&#62;","'","&#39;",'"',"&#34;"];for(var bb=0;bb<ba.length;bb+=2)ba[bb]=new RegExp(ba[bb],"g");a.prototype.escapeHTML=function(a){for(var b=0;b<ba.length;b+=2)a=a.replace(ba[b],ba[b+1]);return a}})()